<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViVi Biļešu Kases Statuss</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 15px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 0;
            border-bottom: 2px solid #334155;
            position: relative;
        }

        .logo {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .logo-text {
            font-size: 48px;
            font-weight: bold;
            color: #fbbf24;
            letter-spacing: 2px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .logo-subtitle {
            font-size: 14px;
            color: #fbbf24;
            letter-spacing: 4px;
            font-weight: 400;
            text-transform: uppercase;
            margin-top: -8px;
        }

        .current-time {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 18px;
            color: #cbd5e1;
        }

        .last-updated {
            font-size: 13px;
            color: #94a3b8;
            margin-top: 8px;
            font-style: italic;
        }

        .last-updated.error {
            color: #ef4444;
            font-weight: 600;
        }

        .error-banner {
            background: #7f1d1d;
            color: #fecaca;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            border: 1px solid #991b1b;
        }

        .line-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .line-btn {
            background: #374151;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .line-btn:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .line-btn.tukums {
            border-left-color: #3b82f6;
        }
        .line-btn.tukums.active {
            background: #3b82f6;
            box-shadow: 0 4px 15px rgba(59,130,246,0.4);
        }

        .line-btn.jelgavas {
            border-left-color: #ef4444;
        }
        .line-btn.jelgavas.active {
            background: #ef4444;
            box-shadow: 0 4px 15px rgba(239,68,68,0.4);
        }

        .line-btn.skulte {
            border-left-color: #f59e0b;
        }
        .line-btn.skulte.active {
            background: #f59e0b;
            box-shadow: 0 4px 15px rgba(245,158,11,0.4);
        }

        .line-btn.aizkraukles {
            border-left-color: #8b5cf6;
        }
        .line-btn.aizkraukles.active {
            background: #8b5cf6;
            box-shadow: 0 4px 15px rgba(139,92,246,0.4);
        }

        .line-content {
            display: none;
        }

        .line-content.active {
            display: block;
        }

        .line-title {
            background: #1e293b;
            color: white;
            padding: 18px 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            border: 2px solid #334155;
        }

        .station {
            background: #1e293b;
            margin-bottom: 16px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }

        .station:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            border-color: #475569;
        }

        .station-header {
            padding: 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .station-header.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .station-info {
            flex: 1;
        }

        .station-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .station-status-text {
            font-size: 15px;
            color: #94a3b8;
        }

        .status-dot {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            margin-left: 16px;
            flex-shrink: 0;
            position: relative;
        }

        .status-dot::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            opacity: 0.3;
            animation: pulse 2s infinite;
        }

        .status-open {
            background: #22c55e;
        }
        .status-open::before {
            background: #22c55e;
        }

        .status-closing-soon {
            background: #3b82f6;
        }
        .status-closing-soon::before {
            background: #3b82f6;
        }

        .status-recently-opened {
            background: #fbbf24;
        }
        .status-recently-opened::before {
            background: #fbbf24;
        }

        .status-recently-closed {
            background: #f59e0b;
        }
        .status-recently-closed::before {
            background: #f59e0b;
        }

        .status-closed {
            background: #ef4444;
        }
        .status-closed::before {
            background: #ef4444;
        }

        .status-error {
            background: #7f1d1d;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.3; }
        }

        .station-details {
            padding: 0 22px 22px;
            font-size: 15px;
            color: #cbd5e1;
            display: none;
            border-top: 1px solid #334155;
            margin-top: 12px;
            padding-top: 20px;
            background: #1e293b;
        }

        .station.expanded .station-details {
            display: block;
        }

        .detail-line {
            margin: 10px 0;
            padding: 12px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 8px;
            border-left: 3px solid #64748b;
        }

        .detail-line.error {
            background: rgba(127, 29, 29, 0.5);
            border-left-color: #ef4444;
            color: #fecaca;
        }

        .detail-line.permanent-notice {
            background: rgba(127, 29, 29, 0.5);
            border-left-color: #ef4444;
            color: #fecaca;
            font-weight: 600;
        }

        @media (max-width: 480px) {
            .line-selector {
                gap: 8px;
            }
            
            .line-btn {
                padding: 12px 18px;
                font-size: 14px;
            }
            
            .station-name {
                font-size: 20px;
            }
            
            .current-time {
                font-size: 26px;
            }

            .logo-text {
                font-size: 36px;
            }

            .logo-subtitle {
                font-size: 12px;
                letter-spacing: 2px;
            }

            .header {
                padding: 15px 0;
            }

            body {
                padding: 10px;
            }

            .station-header {
                padding: 18px;
            }

            .station-details {
                padding: 0 18px 18px;
            }
        }

        @media (max-width: 360px) {
            .logo-text {
                font-size: 28px;
            }

            .logo-subtitle {
                font-size: 10px;
                letter-spacing: 1px;
            }

            .current-time {
                font-size: 22px;
            }

            .subtitle {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-text">ViVi</div>
            <div class="logo-subtitle">VIENĀ VILCIENĀ</div>
        </div>
        <div class="current-time" id="clock"></div>
        <div class="subtitle">Biļešu Kases Statuss</div>
        <div class="last-updated" id="lastUpdated">Ielādē datus...</div>
    </div>

    <div class="line-selector">
        <button class="line-btn tukums active" onclick="showLine('tukums')">Tukuma līnija</button>
        <button class="line-btn jelgavas" onclick="showLine('jelgavas')">Jelgavas līnija</button>
        <button class="line-btn skulte" onclick="showLine('skulte')">Skultes līnija</button>
        <button class="line-btn aizkraukles" onclick="showLine('aizkraukles')">Aizkraukles līnija</button>
    </div>

    <div id="tukums" class="line-content active">
        <div class="line-title">Tukuma līnija</div>
        <div id="tukums-stations"></div>
    </div>

    <div id="jelgavas" class="line-content">
        <div class="line-title">Jelgavas līnija</div>
        <div id="jelgavas-stations"></div>
    </div>

    <div id="skulte" class="line-content">
        <div class="line-title">Skultes līnija</div>
        <div id="skulte-stations"></div>
    </div>

    <div id="aizkraukles" class="line-content">
        <div class="line-title">Aizkraukles līnija</div>
        <div id="aizkraukles-stations"></div>
    </div>

    <script>
        let LINES = {};
        let stationCooldowns = {};
        let lastUpdatedDate = null;
        let dataLoadFailed = false;

        const PERMANENT_NOTICES = {
            'Dubulti': 'Pavisam ciet, vairs nestrādā!'
        };

        const DAY_TRANSLATIONS = {
            'weekday': 'darbadiena',
            'weekend': 'brīvdiena'
        };

        async function loadScheduleData() {
            try {
                const response = await fetch('schedules.json');
                const data = await response.json();
                LINES = data.lines;
                lastUpdatedDate = new Date(data.lastUpdated);
                
                const now = new Date();
                const daysDiff = Math.floor((now - lastUpdatedDate) / (1000 * 60 * 60 * 24));
                
                const formatted = lastUpdatedDate.toLocaleDateString('lv-LV', { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric' 
                });
                
                const lastUpdatedEl = document.getElementById('lastUpdated');
                
                if (daysDiff > 60) {
                    lastUpdatedEl.textContent = `Kļūda iegūt datus! Rāda informāciju no ${formatted}`;
                    lastUpdatedEl.classList.add('error');
                    dataLoadFailed = true;
                } else {
                    lastUpdatedEl.textContent = `Pēdējoreiz dati atjaunoti: ${formatted}`;
                }
            } catch (error) {
                console.error('Failed to load schedules.json:', error);
                LINES = getFallbackData();
                const fallbackDate = new Date('2026-01-20T13:19:22.435Z');
                lastUpdatedDate = fallbackDate;
                
                const formatted = fallbackDate.toLocaleDateString('lv-LV', { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric' 
                });
                
                const lastUpdatedEl = document.getElementById('lastUpdated');
                lastUpdatedEl.textContent = `Kļūda iegūt datus! Rāda informāciju no ${formatted}`;
                lastUpdatedEl.classList.add('error');
                dataLoadFailed = true;
            }
            
            updateStations();
        }

        function getFallbackData() {
            return {
                "tukums": {"name": "Tukuma līnija", "stations": {"Rīga": {"type": "segments", "weekday": ["04:35-23:50"], "weekend": ["04:35-23:50"]}, "Torņakalns": {"type": "segments", "weekday": ["07:00-08:40", "08:55-12:00", "12:15-13:15", "13:25-15:20"], "weekend": []}, "Zasulauks": {"type": "segments", "weekday": ["06:55-08:50", "09:00-10:50", "11:10-12:25", "12:40-14:30", "14:40-16:30", "16:40-17:55"], "weekend": ["07:55-08:50", "09:00-10:50", "11:10-12:25", "12:40-14:30", "14:40-16:30", "16:40-17:55"]}, "Zolitūde": {"type": "segments", "weekday": ["06:50-07:45", "07:55-09:45", "09:55-11:30", "11:40-13:30", "13:50-15:30", "15:40-17:30", "17:40-18:05"], "weekend": ["07:50-09:45", "09:55-11:30", "11:40-13:30", "13:50-15:30", "15:40-17:30", "17:40-18:05"]}, "Imanta": {"type": "segments", "weekday": ["06:35-08:00", "08:10-09:15", "09:25-11:15", "11:25-13:05", "13:20-15:30", "15:40-17:00", "17:10-18:30"], "weekend": ["07:35-08:00", "08:10-09:15", "09:25-11:15", "11:25-13:05", "13:20-15:30", "15:40-17:00", "17:10-18:30"]}, "Bulduri": {"type": "segments", "weekday": ["07:20-09:35", "09:50-11:35", "11:50-13:20", "13:35-15:20", "15:35-18:20"], "weekend": ["08:20-09:35", "09:50-11:35", "11:50-13:20", "13:35-15:20", "15:35-18:20"]}, "Majori": {"type": "segments", "weekday": ["07:15-09:15", "09:25-11:20", "11:30-13:25", "13:35-15:25", "15:35-17:25", "17:35-18:45"], "weekend": ["08:15-09:15", "09:25-11:20", "11:30-13:25", "13:35-15:25", "15:35-17:25", "17:35-18:45"]}, "Dubulti": {"type": "segments", "weekday": [], "weekend": []}, "Sloka": {"type": "segments", "weekday": ["04:30-07:35", "07:50-09:35", "09:55-11:35", "11:55-14:20", "14:40-16:20", "16:35-18:20"], "weekend": ["04:30-07:35", "07:50-09:35", "09:55-11:35", "11:55-14:20", "14:40-16:20", "16:35-18:20"]}, "Tukums I": {"type": "segments", "weekday": ["06:45-08:05", "08:35-09:05", "09:35-11:55", "12:55-13:50", "14:05-15:50"], "weekend": ["06:45-08:05", "08:35-09:05", "09:35-11:55", "12:55-13:50", "14:05-15:50"]}}},
                "jelgavas": {"name": "Jelgavas līnija", "stations": {"Rīga": {"type": "segments", "weekday": ["04:35-23:50"], "weekend": ["04:35-23:50"]}, "Torņakalns": {"type": "segments", "weekday": ["07:00-08:40", "08:55-12:00", "12:15-13:15", "13:25-15:20"], "weekend": []}, "Olaine": {"type": "segments", "weekday": ["06:45-10:05", "10:25-12:05", "12:35-15:05", "15:30-18:25"], "weekend": ["06:45-10:05", "10:25-12:05", "12:35-15:05", "15:30-17:35"]}, "Jelgava": {"type": "segments", "weekday": ["04:25-06:56", "07:06-08:57", "09:07-09:39", "10:10-11:39", "12:10-13:39", "14:20-14:39", "15:20-15:39", "16:20-16:53", "17:03-19:05"], "weekend": ["04:25-06:56", "07:06-08:57", "09:07-09:39", "10:10-11:39", "12:10-13:39", "14:20-14:39", "15:20-15:39", "16:20-16:53", "17:03-19:05"]}}},
                "skulte": {"name": "Skultes līnija", "stations": {"Rīga": {"type": "segments", "weekday": ["04:35-23:50"], "weekend": ["04:35-23:50"]}, "Zemitāni": {"type": "segments", "weekday": ["07:25-09:20", "09:35-12:20", "12:35-14:20", "14:35-17:35", "17:45-19:10"], "weekend": ["07:25-09:20", "09:35-12:20", "12:35-14:20", "14:35-17:35", "17:45-19:10"]}}},
                "aizkraukles": {"name": "Aizkraukles līnija", "stations": {"Rīga": {"type": "segments", "weekday": ["04:35-23:50"], "weekend": ["04:35-23:50"]}, "Salaspils": {"type": "segments", "weekday": ["06:10-08:35", "08:50-11:30", "11:55-13:35", "14:05-15:00", "15:15-16:05", "16:15-18:35"], "weekend": ["06:10-08:35", "08:50-11:30", "11:55-13:35", "14:05-15:00", "15:15-16:05", "16:15-18:35"]}, "Ogre": {"type": "segments", "weekday": ["04:55-06:10", "06:20-09:10", "09:30-11:10", "11:40-13:35", "13:50-16:20", "16:30-19:55", "20:05-21:20"], "weekend": ["04:55-06:10", "06:20-09:10", "09:30-11:10", "11:40-13:35", "13:50-16:20", "16:30-19:55", "20:05-21:20"]}, "Lielvārde": {"type": "segments", "weekday": ["06:30-09:30", "09:45-10:55", "11:10-13:55", "14:25-18:00"], "weekend": ["06:30-09:30", "09:45-10:55", "11:10-13:55", "14:25-18:00"]}, "Aizkraukle": {"type": "segments", "weekday": ["06:05-08:20", "08:35-09:55", "10:10-11:30", "12:00-13:05", "13:15-16:05"], "weekend": ["06:05-08:20", "08:35-09:55", "10:10-11:30", "12:00-13:05", "13:15-16:05"]}}}
            };
        }

        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('lv-LV', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('clock').textContent = time;
        }

        function timeToMinutes(time) {
            const [h, m] = time.split(':').map(Number);
            return h * 60 + m;
        }

        function getCurrentDay() {
            const day = new Date().getDay();
            return (day === 0 || day === 6) ? 'weekend' : 'weekday';
        }

        function parseSchedule(scheduleArray) {
            return scheduleArray.map(segment => {
                const [start, end] = segment.split('-');
                return { start, end, startMin: timeToMinutes(start), endMin: timeToMinutes(end) };
            });
        }

        function getStationStatus(stationData, stationName) {
            // Check for permanent notice
            if (PERMANENT_NOTICES[stationName]) {
                return { 
                    status: 'closed', 
                    message: 'Nestrādā vispār', 
                    details: 'Pavisam ciet, vairs nestrādā'
                };
            }

            // Check if data is unavailable
            if (stationData.dataUnavailable || stationData.weekday === null || stationData.weekend === null) {
                return { 
                    status: 'error', 
                    message: 'Dati nav pieejami', 
                    details: 'Nevarēja iegūt datus', 
                    isError: true 
                };
            }

            if (stationData.type === '24h') {
                return { status: 'open', message: 'Atvērts 24/7', details: 'Vienmēr pieejams' };
            }

            const now = new Date();
            const currentMin = now.getHours() * 60 + now.getMinutes();
            const day = getCurrentDay();
            
            const schedule = stationData[day];
            
            // Check if data is missing for today (null vs empty array)
            if (schedule === null || schedule === undefined) {
                return { 
                    status: 'error', 
                    message: 'Dati nav pieejami', 
                    details: 'Nevarēja iegūt datus', 
                    isError: true 
                };
            }
            
            // Empty array means station doesn't work on this day (intentional)
            if (schedule.length === 0) {
                return { status: 'closed', message: 'Šodien slēgts', details: 'Šodien nedarbojas', weekendClosed: true };
            }

            const segments = parseSchedule(schedule);

            // Check if recently opened (10 minutes)
            for (const segment of segments) {
                if (currentMin >= segment.startMin && currentMin <= segment.startMin + 10) {
                    return { 
                        status: 'recently-opened', 
                        message: 'Tikko atvērts',
                        details: `Atvērts plkst. ${segment.start}`
                    };
                }
            }

            // Check if recently closed (10 minutes)
            for (const segment of segments) {
                if (currentMin > segment.endMin && currentMin <= segment.endMin + 10) {
                    return { 
                        status: 'recently-closed', 
                        message: 'Tikko slēgts',
                        details: `Slēgts plkst. ${segment.end}`
                    };
                }
            }

            // Check if currently open
            for (const segment of segments) {
                if (currentMin >= segment.startMin && currentMin <= segment.endMin) {
                    const remaining = segment.endMin - currentMin;
                    if (remaining <= 10) {
                        return { 
                            status: 'closing-soon', 
                            message: `Slēgsies pēc ${remaining} min`,
                            details: `Atvērts līdz ${segment.end}`
                        };
                    }
                    return { 
                        status: 'open', 
                        message: `Atvērts līdz ${segment.end}`,
                        details: `Pašlaik atvērts`
                    };
                }
            }

            // Find next opening time
            for (const segment of segments) {
                if (currentMin < segment.startMin) {
                    return { 
                        status: 'closed', 
                        message: `Atvērsies plkst. ${segment.start}`,
                        details: 'Pašlaik slēgts'
                    };
                }
            }

            return { status: 'closed', message: 'Šodien vairs nestrādā', details: 'Šodien vairs nestrādā' };
        }

        function createStationHTML(name, data) {
            const status = getStationStatus(data, name);
            const day = getCurrentDay();
            
            let scheduleText = 'Nav grafika';
            
            if (data.dataUnavailable || data.weekday === null || data.weekend === null) {
                scheduleText = '<span style="color: #ef4444;">Nevarēja iegūt datus</span>';
            } else if (data.type === '24h') {
                scheduleText = '24/7 apkalpošana';
            } else if (status.isError) {
                scheduleText = '<span style="color: #ef4444;">Nevarēja iegūt datus</span>';
            } else if (data[day] && data[day].length > 0) {
                const dayName = DAY_TRANSLATIONS[day] || day;
                scheduleText = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)}: ${data[day].join(', ')}`;
            } else if (data[day] !== null && data[day] !== undefined) {
                const dayName = DAY_TRANSLATIONS[day] || day;
                scheduleText = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)}: Slēgts`;
            } else {
                scheduleText = '<span style="color: #ef4444;">Nevarēja iegūt datus</span>';
            }

            const permanentNoticeHTML = '';

            return `
                <div class="station" data-station="${name}">
                    <div class="station-header" onclick="toggleDetails(this, '${name}')">
                        <div class="station-info">
                            <div class="station-name">${name}</div>
                            <div class="station-status-text">${status.message}</div>
                        </div>
                        <div class="status-dot status-${status.status}"></div>
                    </div>
                    <div class="station-details">
                        <div class="detail-line ${status.isError ? 'error' : ''}"><strong>Statuss:</strong> ${status.details}</div>
                        <div class="detail-line"><strong>Darba laiks:</strong> ${scheduleText}</div>
                    </div>
                </div>
            `;
        }

        function updateStations() {
            Object.keys(LINES).forEach(lineId => {
                const line = LINES[lineId];
                const container = document.getElementById(lineId + '-stations');
                if (container) {
                    container.innerHTML = '';
                    Object.entries(line.stations).forEach(([name, data]) => {
                        container.innerHTML += createStationHTML(name, data);
                    });
                }
            });
        }

        function showLine(lineId) {
            document.querySelectorAll('.line-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.line-btn.${lineId}`).classList.add('active');

            document.querySelectorAll('.line-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(lineId).classList.add('active');
        }

        function toggleDetails(headerElement, stationName) {
            const stationElement = headerElement.parentElement;
            const cooldownKey = stationName;
            const now = Date.now();
            
            if (stationCooldowns[cooldownKey] && now - stationCooldowns[cooldownKey] < 500) {
                return;
            }
            
            stationCooldowns[cooldownKey] = now;
            
            headerElement.classList.add('disabled');
            setTimeout(() => {
                headerElement.classList.remove('disabled');
            }, 500);
            
            stationElement.classList.toggle('expanded');
        }

        // Initialization
        updateClock();
        loadScheduleData();

        // Auto-refresh every 30 seconds
        setInterval(() => {
            updateClock();
            updateStations();
        }, 30000);

        // Update clock every second
        setInterval(updateClock, 1000);
    </script>
</body>
</html>