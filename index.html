<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViVi Biļešu Kases Statuss</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: white;
            padding: 15px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 0;
            border-bottom: 2px solid #334155;
            position: relative;
        }

        .logo {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .logo-text {
            font-size: 48px;
            font-weight: bold;
            color: #fbbf24;
            letter-spacing: 2px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .logo-subtitle {
            font-size: 14px;
            color: #fbbf24;
            letter-spacing: 4px;
            font-weight: 400;
            text-transform: uppercase;
            margin-top: -8px;
        }

        .current-time {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 18px;
            color: #cbd5e1;
        }

        .last-updated {
            font-size: 13px;
            color: #94a3b8;
            margin-top: 8px;
            font-style: italic;
        }

        .line-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .line-btn {
            background: #374151;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .line-btn:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .line-btn.tukums {
            border-left-color: #3b82f6;
        }
        .line-btn.tukums.active {
            background: #3b82f6;
            box-shadow: 0 4px 15px rgba(59,130,246,0.4);
        }

        .line-btn.jelgavas {
            border-left-color: #ef4444;
        }
        .line-btn.jelgavas.active {
            background: #ef4444;
            box-shadow: 0 4px 15px rgba(239,68,68,0.4);
        }

        .line-btn.skulte {
            border-left-color: #f59e0b;
        }
        .line-btn.skulte.active {
            background: #f59e0b;
            box-shadow: 0 4px 15px rgba(245,158,11,0.4);
        }

        .line-btn.aizkraukles {
            border-left-color: #8b5cf6;
        }
        .line-btn.aizkraukles.active {
            background: #8b5cf6;
            box-shadow: 0 4px 15px rgba(139,92,246,0.4);
        }

        .line-content {
            display: none;
        }

        .line-content.active {
            display: block;
        }

        .line-title {
            background: #1e293b;
            color: white;
            padding: 18px 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            border: 2px solid #334155;
        }

        .station {
            background: #1e293b;
            margin-bottom: 16px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }

        .station:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            border-color: #475569;
        }

        .station-header {
            padding: 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .station-header.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .station-info {
            flex: 1;
        }

        .station-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .station-status-text {
            font-size: 15px;
            color: #94a3b8;
        }

        .status-dot {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            margin-left: 16px;
            flex-shrink: 0;
            position: relative;
        }

        .status-dot::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            opacity: 0.3;
            animation: pulse 2s infinite;
        }

        .status-open {
            background: #22c55e;
        }
        .status-open::before {
            background: #22c55e;
        }

        .status-closing-soon {
            background: #3b82f6;
        }
        .status-closing-soon::before {
            background: #3b82f6;
        }

        .status-recently-opened {
            background: #fbbf24;
        }
        .status-recently-opened::before {
            background: #fbbf24;
        }

        .status-closed {
            background: #ef4444;
        }
        .status-closed::before {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.3; }
        }

        .station-details {
            padding: 0 22px 22px;
            font-size: 15px;
            color: #cbd5e1;
            display: none;
            border-top: 1px solid #334155;
            margin-top: 12px;
            padding-top: 20px;
            background: #1e293b;
        }

        .station.expanded .station-details {
            display: block;
        }

        .detail-line {
            margin: 10px 0;
            padding: 12px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 8px;
            border-left: 3px solid #64748b;
        }

        @media (max-width: 480px) {
            .line-selector {
                gap: 8px;
            }
            
            .line-btn {
                padding: 12px 18px;
                font-size: 14px;
            }
            
            .station-name {
                font-size: 20px;
            }
            
            .current-time {
                font-size: 26px;
            }

            .logo-text {
                font-size: 36px;
            }

            .logo-subtitle {
                font-size: 12px;
                letter-spacing: 2px;
            }

            .header {
                padding: 15px 0;
            }

            body {
                padding: 10px;
            }

            .station-header {
                padding: 18px;
            }

            .station-details {
                padding: 0 18px 18px;
            }
        }

        @media (max-width: 360px) {
            .logo-text {
                font-size: 28px;
            }

            .logo-subtitle {
                font-size: 10px;
                letter-spacing: 1px;
            }

            .current-time {
                font-size: 22px;
            }

            .subtitle {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-text">ViVi</div>
            <div class="logo-subtitle">VIENĀ VILCIENĀ</div>
        </div>
        <div class="current-time" id="clock"></div>
        <div class="subtitle">Biļešu Kases Statuss</div>
        <div class="last-updated" id="lastUpdated">Ielādē datus...</div>
    </div>

    <div class="line-selector">
        <button class="line-btn tukums active" onclick="showLine('tukums')">Tukuma līnija</button>
        <button class="line-btn jelgavas" onclick="showLine('jelgavas')">Jelgavas līnija</button>
        <button class="line-btn skulte" onclick="showLine('skulte')">Skultes līnija</button>
        <button class="line-btn aizkraukles" onclick="showLine('aizkraukles')">Aizkraukles līnija</button>
    </div>

    <div id="tukums" class="line-content active">
        <div class="line-title">Tukuma līnija</div>
        <div id="tukums-stations"></div>
    </div>

    <div id="jelgavas" class="line-content">
        <div class="line-title">Jelgavas līnija</div>
        <div id="jelgavas-stations"></div>
    </div>

    <div id="skulte" class="line-content">
        <div class="line-title">Skultes līnija</div>
        <div id="skulte-stations"></div>
    </div>

    <div id="aizkraukles" class="line-content">
        <div class="line-title">Aizkraukles līnija</div>
        <div id="aizkraukles-stations"></div>
    </div>

    <script>
        let LINES = {};
        let stationCooldowns = {};

        const DAY_TRANSLATIONS = {
            'weekday': 'darbadiena',
            'saturday': 'sestdiena',
            'sunday': 'svētdiena'
        };

        // Load data from schedules.json or use fallback
        async function loadScheduleData() {
            try {
                const response = await fetch('schedules.json');
                const data = await response.json();
                LINES = data.lines;
                
                // Update last updated text
                const date = new Date(data.lastUpdated);
                const formatted = date.toLocaleDateString('lv-LV', { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric' 
                });
                document.getElementById('lastUpdated').textContent = `Pēdējoreiz dati atjaunoti: ${formatted}`;
            } catch (error) {
                console.log('Could not load schedules.json, using fallback data');
                // Fallback to hardcoded data
                LINES = getFallbackData();
                document.getElementById('lastUpdated').textContent = 'Kļūda! Tiek izmantoti iespējams nepareizi dati!';
            }
            
            updateStations();
        }

        function getFallbackData() {
            return {
                tukums: {
                    name: 'Tukuma līnija',
                    stations: {
                        'Rīga': { 
                            type: 'segments',
                            weekday: ['04:35-23:50'],
                            saturday: ['04:35-23:50'],
                            sunday: ['04:35-23:50']
                        },
                        'Torņakalns': {
                            type: 'segments',
                            weekday: ['07:00-09:10', '09:20-12:05', '12:20-13:05', '13:15-15:40', '15:50-17:00'],
                            saturday: ['07:00-09:10', '09:20-12:05', '12:20-13:05', '13:15-15:40', '15:50-17:00'],
                            sunday: []
                        },
                        'Zasulauks': {
                            type: 'segments',
                            weekday: ['06:55-08:50', '09:00-10:40', '11:00-13:40', '14:00-16:25', '16:30-17:55', '18:00-18:55'],
                            saturday: ['06:55-08:50', '09:00-10:40', '11:00-13:40', '14:00-16:25', '16:30-17:55', '18:00-18:55'],
                            sunday: ['06:55-08:50', '09:00-10:40', '11:00-13:40', '14:00-16:25', '16:30-17:55', '18:00-18:55']
                        },
                        'Zolitūde': {
                            type: 'segments',
                            weekday: ['06:50-10:20', '10:35-13:20', '13:45-14:50', '15:05-17:20', '17:25-18:50'],
                            saturday: ['06:50-10:20', '10:35-13:20', '13:45-14:50', '15:05-17:20', '17:25-18:50'],
                            sunday: ['06:50-10:20', '10:35-13:20', '13:45-14:50', '15:05-17:20', '17:25-18:50']
                        },
                        'Imanta': {
                            type: 'segments',
                            weekday: ['06:35-08:30', '08:40-10:50', '10:00-15:20', '11:05-12:50', '13:05-14:45', '14:55-17:30', '17:40-18:50'],
                            saturday: ['06:35-08:30', '08:40-10:50', '10:00-15:20', '11:05-12:50', '13:05-14:45', '14:55-17:30', '17:40-18:50'],
                            sunday: ['06:35-08:30', '08:40-10:50', '10:00-15:20', '11:05-12:50', '13:05-14:45', '14:55-17:30', '17:40-18:50']
                        },
                        'Bulduri': {
                            type: 'segments',
                            weekday: ['07:10-09:35', '09:50-11:35', '11:50-13:35', '13:50-15:35', '15:45-18:10'],
                            saturday: ['07:10-09:35', '09:50-11:35', '11:50-13:35', '13:50-15:35', '15:45-18:10'],
                            sunday: ['07:10-09:35', '09:50-11:35', '11:50-13:35', '13:50-15:35', '15:45-18:10']
                        },
                        'Majori': {
                            type: 'segments',
                            weekday: ['07:15-09:35', '09:50-11:35', '11:50-13:35', '13:50-15:35', '15:45-17:35', '17:40-19:05'],
                            saturday: ['07:15-09:35', '09:50-11:35', '11:50-13:35', '13:50-15:35', '15:45-17:35', '17:40-19:05'],
                            sunday: ['07:15-09:35', '09:50-11:35', '11:50-13:35', '13:50-15:35', '15:45-17:35', '17:40-19:05']
                        },
                        'Dubulti': {
                            type: 'segments',
                            weekday: ['07:10-09:35', '09:45-10:25', '10:40-13:25', '13:40-15:25', '15:40-17:25', '17:30-18:10'],
                            saturday: ['07:45-09:35', '09:45-10:25', '10:40-13:25', '13:40-15:25', '15:40-17:25'],
                            sunday: ['07:45-09:35', '09:45-10:25', '10:40-13:25', '13:40-15:25', '15:40-17:25']
                        },
                        'Sloka': {
                            type: 'segments',
                            weekday: ['04:55-07:40', '07:50-09:40', '09:55-12:40', '12:55-14:40', '14:55-16:40', '16:55-18:45', '18:55-19:45'],
                            saturday: ['04:55-07:40', '07:50-09:40', '09:55-12:40', '12:55-14:40', '14:55-16:40', '16:55-18:45', '18:55-19:45'],
                            sunday: ['04:55-07:40', '07:50-09:40', '09:55-12:40', '12:55-14:40', '14:55-16:40', '16:55-18:45', '18:55-19:45']
                        },
                        'Tukums I': {
                            type: 'segments',
                            weekday: ['06:30-08:15', '08:30-09:15', '09:45-11:15', '12:30-15:15', '15:30-16:15', '16:30-17:15'],
                            saturday: ['06:30-08:15', '08:30-09:15', '09:45-11:15', '12:30-15:15', '15:30-16:15', '16:30-17:15'],
                            sunday: ['06:30-08:15', '08:30-09:15', '09:45-11:15', '12:30-15:15', '15:30-16:15', '16:30-17:15']
                        }
                    }
                },
                jelgavas: {
                    name: 'Jelgavas līnija',
                    stations: {
                        'Rīga': { 
                            type: 'segments',
                            weekday: ['04:35-23:50'],
                            saturday: ['04:35-23:50'],
                            sunday: ['04:35-23:50']
                        },
                        'Torņakalns': {
                            type: 'segments',
                            weekday: ['07:00-09:10', '09:20-12:05', '12:20-13:05', '13:15-15:40', '15:50-17:00'],
                            saturday: ['07:00-09:10', '09:20-12:05', '12:20-13:05', '13:15-15:40', '15:50-17:00'],
                            sunday: []
                        },
                        'Olaine': {
                            type: 'segments',
                            weekday: ['04:45-06:35', '06:40-09:00', '09:20-12:00', '12:35-15:05', '15:30-17:35', '17:45-19:35'],
                            saturday: ['06:30-09:00', '09:20-12:05', '12:35-15:05', '15:30-18:05'],
                            sunday: ['06:30-09:00', '09:20-12:05', '12:35-15:05', '15:30-18:05']
                        },
                        'Jelgava': {
                            type: 'segments',
                            weekday: ['04:25-06:38', '06:48-08:40', '09:00-09:40', '10:10-11:40', '12:10-13:40', '14:20-14:38', '15:20-15:38', '16:20-19:10'],
                            saturday: ['04:25-06:38', '06:48-08:40', '09:00-09:40', '10:10-11:40', '12:10-13:40', '14:20-14:38', '15:20-15:38', '16:20-19:10'],
                            sunday: ['04:25-06:38', '06:48-08:40', '09:00-09:40', '10:10-11:40', '12:10-13:40', '14:20-14:38', '15:20-15:38', '16:20-19:10']
                        }
                    }
                },
                skulte: {
                    name: 'Skultes līnija',
                    stations: {
                        'Rīga': { 
                            type: 'segments',
                            weekday: ['04:35-23:50'],
                            saturday: ['04:35-23:50'],
                            sunday: ['04:35-23:50']
                        },
                        'Zemitāni': {
                            type: 'segments',
                            weekday: ['06:30-09:00', '09:10-11:50', '12:00-13:50', '14:00-15:45', '16:05-19:00'],
                            saturday: ['07:15-09:00', '09:10-11:50', '12:00-13:50', '14:00-15:45', '16:05-19:00'],
                            sunday: ['07:15-09:00', '09:10-11:50', '12:00-13:50', '14:00-15:45', '16:05-19:00']
                        }
                    }
                },
                aizkraukles: {
                    name: 'Aizkraukles līnija',
                    stations: {
                        'Rīga': { 
                            type: 'segments',
                            weekday: ['04:35-23:50'],
                            saturday: ['04:35-23:50'],
                            sunday: ['04:35-23:50']
                        },
                        'Salaspils': {
                            type: 'segments',
                            weekday: ['06:05-08:25', '08:35-11:25', '11:55-12:25', '12:55-14:05', '14:20-16:05', '16:15-18:35'],
                            saturday: ['06:05-08:25', '08:35-11:25', '11:55-12:25', '12:55-14:05', '14:20-16:05', '16:15-18:35'],
                            sunday: ['06:05-08:25', '08:35-11:25', '11:55-12:25', '12:55-14:05', '14:20-16:05', '16:15-18:35']
                        },
                        'Ogre': {
                            type: 'segments',
                            weekday: ['05:00-06:10', '06:20-08:50', '09:10-11:25', '11:55-14:10', '14:40-16:20', '16:30-19:45', '19:55-21:20'],
                            saturday: ['05:00-06:10', '06:20-08:50', '09:10-11:25', '11:55-14:10', '14:40-16:20', '16:30-19:45', '19:55-21:20'],
                            sunday: ['05:00-06:10', '06:20-08:50', '09:10-11:25', '11:55-14:10', '14:40-16:20', '16:30-19:45', '19:55-21:20']
                        },
                        'Lielvārde': {
                            type: 'segments',
                            weekday: ['06:30-09:30', '09:45-10:55', '11:10-12:55', '13:30-15:30', '15:45-17:55'],
                            saturday: ['06:30-09:30', '09:45-10:55', '11:10-12:55', '13:30-15:30', '15:45-17:55'],
                            sunday: ['06:30-09:30', '09:45-10:55', '11:10-12:55', '13:30-15:30', '15:45-17:55']
                        },
                        'Aizkraukle': {
                            type: 'segments',
                            weekday: ['06:00-08:15', '08:30-09:55', '09:10-11:30', '12:00-13:05', '13:15-16:10'],
                            saturday: ['06:00-08:15', '08:30-09:55', '09:10-11:30', '12:00-13:05', '13:15-16:10'],
                            sunday: ['06:00-08:15', '08:30-09:55', '09:10-11:30', '12:00-13:05', '13:15-16:10']
                        }
                    }
                }
            };
        }

        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('lv-LV', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('clock').textContent = time;
        }

        function timeToMinutes(time) {
            const [h, m] = time.split(':').map(Number);
            return h * 60 + m;
        }

        function getCurrentDay() {
            const day = new Date().getDay();
            if (day === 0) return 'sunday';
            if (day === 6) return 'saturday';
            return 'weekday';
        }

        function parseSchedule(scheduleArray) {
            return scheduleArray.map(segment => {
                const [start, end] = segment.split('-');
                return { start, end, startMin: timeToMinutes(start), endMin: timeToMinutes(end) };
            });
        }

        function getStationStatus(stationData) {
            if (stationData.type === '24h') {
                return { status: 'open', message: 'Atvērts 24/7', details: 'Vienmēr pieejams' };
            }

            const now = new Date();
            const currentMin = now.getHours() * 60 + now.getMinutes();
            const day = getCurrentDay();
            
            const schedule = stationData[day] || [];
            
            if (schedule.length === 0) {
                return { status: 'closed', message: 'Šodien slēgts', details: 'Šodien nedarbojas' };
            }

            const segments = parseSchedule(schedule);

            // Pārbauda, vai tikko atvērts (15 minūšu robežās no atvēršanas)
            for (const segment of segments) {
                if (currentMin >= segment.startMin && currentMin <= segment.startMin + 15) {
                    return { 
                        status: 'recently-opened', 
                        message: 'Tikko atvērts',
                        details: `Atvērts plkst. ${segment.start}`
                    };
                }
            }

            // Pārbauda, vai pašlaik atvērts
            for (const segment of segments) {
                if (currentMin >= segment.startMin && currentMin <= segment.endMin) {
                    const remaining = segment.endMin - currentMin;
                    if (remaining <= 10) {
                        return { 
                            status: 'closing-soon', 
                            message: `Slēgsies pēc ${remaining} min`,
                            details: `Atvērts līdz ${segment.end}`
                        };
                    }
                    return { 
                        status: 'open', 
                        message: `Atvērts līdz ${segment.end}`,
                        details: `Pašlaik atvērts`
                    };
                }
            }

            // Atrod nākamo atvēršanas laiku
            for (const segment of segments) {
                if (currentMin < segment.startMin) {
                    return { 
                        status: 'closed', 
                        message: `Atvērsies plkst. ${segment.start}`,
                        details: 'Pašlaik slēgts'
                    };
                }
            }

            // Ja visi darba laiki šodien ir beidzušies
            return { status: 'closed', message: 'Šodien vairs nestrādā', details: 'Šodien vairs nestrādā' };
        }

        function createStationHTML(name, data) {
            const status = getStationStatus(data);
            const day = getCurrentDay();
            
            let scheduleText = 'Nav grafika';
            if (data.type === '24h') {
                scheduleText = '24/7 apkalpošana';
            } else if (data[day] && data[day].length > 0) {
                const dayName = DAY_TRANSLATIONS[day] || day;
                scheduleText = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)}: ${data[day].join(', ')}`;
            } else {
                const dayName = DAY_TRANSLATIONS[day] || day;
                scheduleText = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)}: Slēgts`;
            }

            return `
                <div class="station" data-station="${name}">
                    <div class="station-header" onclick="toggleDetails(this, '${name}')">
                        <div class="station-info">
                            <div class="station-name">${name}</div>
                            <div class="station-status-text">${status.message}</div>
                        </div>
                        <div class="status-dot status-${status.status}"></div>
                    </div>
                    <div class="station-details">
                        <div class="detail-line"><strong>Statuss:</strong> ${status.details}</div>
                        <div class="detail-line"><strong>Darba laiks:</strong> ${scheduleText}</div>
                    </div>
                </div>
            `;
        }

        function updateStations() {
            Object.keys(LINES).forEach(lineId => {
                const line = LINES[lineId];
                const container = document.getElementById(lineId + '-stations');
                if (container) {
                    container.innerHTML = '';
                    Object.entries(line.stations).forEach(([name, data]) => {
                        container.innerHTML += createStationHTML(name, data);
                    });
                }
            });
        }

        function showLine(lineId) {
            document.querySelectorAll('.line-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.line-btn.${lineId}`).classList.add('active');

            document.querySelectorAll('.line-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(lineId).classList.add('active');
        }

        function toggleDetails(headerElement, stationName) {
            const stationElement = headerElement.parentElement;
            const cooldownKey = stationName;
            const now = Date.now();
            
            if (stationCooldowns[cooldownKey] && now - stationCooldowns[cooldownKey] < 500) {
                return;
            }
            
            stationCooldowns[cooldownKey] = now;
            
            headerElement.classList.add('disabled');
            setTimeout(() => {
                headerElement.classList.remove('disabled');
            }, 500);
            
            stationElement.classList.toggle('expanded');
        }

        // Inicializācija
        updateClock();
        loadScheduleData();

        // Automātiski atjauno ik pēc 30 sekundēm
        setInterval(() => {
            updateClock();
            updateStations();
        }, 30000);

        // Atjauno pulksteni katru sekundi
        setInterval(updateClock, 1000);
    </script>
</body>
</html>